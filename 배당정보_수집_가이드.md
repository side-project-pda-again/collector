# ë°°ë‹¹ ì •ë³´ ìˆ˜ì§‘ ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” í•œêµ­ ë° ë¯¸êµ­ ì£¼ì‹ì˜ ë°°ë‹¹ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë“¤ì˜ ì‚¬ìš©ë²•ê³¼ ì£¼ìš” ë¡œì§ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
stockproject/
â”œâ”€â”€ dividend_export.py      # ê°œë³„ ì¢…ëª© ë°°ë‹¹ ì •ë³´ ìˆ˜ì§‘
â”œâ”€â”€ batch_dividends.py      # ì¢…ëª© ëª©ë¡ ê¸°ë°˜ ë°°ë‹¹ ì •ë³´ ì¼ê´„ ìˆ˜ì§‘
â””â”€â”€ requirements.txt        # í•„ìš”í•œ íŒ¨í‚¤ì§€ ëª©ë¡
```

## ğŸ”§ ì‚¬ìš©ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬

### ê³µí†µ ë¼ì´ë¸ŒëŸ¬ë¦¬
- **pandas**: ë°ì´í„° ì²˜ë¦¬ ë° CSV ì €ì¥
- **yfinance**: Yahoo Finance APIë¥¼ í†µí•œ ë°°ë‹¹ ë°ì´í„° ìˆ˜ì§‘
- **datetime**: ë‚ ì§œ ì²˜ë¦¬ ë° ë³€í™˜

### ì¶”ê°€ ë¼ì´ë¸ŒëŸ¬ë¦¬ (batch_dividends.py)
- **typing**: íƒ€ì… íŒíŠ¸ ì§€ì›
- **os**: íŒŒì¼ ì‹œìŠ¤í…œ ì‘ì—…

## ğŸ’° ê°œë³„ ì¢…ëª© ë°°ë‹¹ ìˆ˜ì§‘ (dividend_export.py)

### ì£¼ìš” ê¸°ëŠ¥
- ë‹¨ì¼ ì¢…ëª©ì˜ ë°°ë‹¹ ì •ë³´ ìˆ˜ì§‘
- í•œêµ­ ì£¼ì‹ ë° ë¯¸êµ­ ì£¼ì‹ ì§€ì›
- ì§€ì •ëœ ê¸°ê°„ì˜ ë°°ë‹¹ ë‚´ì—­ ì¡°íšŒ
- CSV í˜•íƒœë¡œ ë°°ë‹¹ ì •ë³´ ì €ì¥

### ì£¼ìš” ë¡œì§ ìˆœì„œ

1. **ëª…ë ¹í–‰ ì¸ì íŒŒì‹±**
ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ì¢…ëª©ê³¼ ê¸°ê°„ì„ ìœ ì—°í•˜ê²Œ ì§€ì •í•  ìˆ˜ ìˆë„ë¡ CLI ì¸í„°í˜ì´ìŠ¤ ì œê³µ
   - `--ticker`: ì¢…ëª©ì½”ë“œ ë˜ëŠ” í‹°ì»¤ (ì˜ˆ: 001720, AAPL)
   - `--market`: ì‹œì¥ ì½”ë“œ (KOSPI/KOSDAQ/KONEX/US)
   - `--start`: ì‹œì‘ì¼ (YYYYMMDD)
   - `--end`: ì¢…ë£Œì¼ (YYYYMMDD)
   - `--out`: ì¶œë ¥ íŒŒì¼ëª…

2. **ì‹œì¥ ì½”ë“œì— ë”°ë¼ Yahoo í‹°ì»¤ ì ‘ë¯¸ì‚¬ ë°˜í™˜**
   Yahoo FinanceëŠ” í•œêµ­ ì£¼ì‹ì— ì‹œì¥ êµ¬ë¶„ ì ‘ë¯¸ì‚¬(.KS, .KQ)ê°€ í•„ìš”í•˜ì§€ë§Œ, ë¯¸êµ­ ì£¼ì‹ì€ ì ‘ë¯¸ì‚¬ê°€ ì—†ì–´ì„œ ì‹œì¥ë³„ë¡œ ë‹¤ë¥¸ í‹°ì»¤ í˜•ì‹ì„ ì‚¬ìš©í•´ì•¼ í•¨
   ```python
   # í•œêµ­ ì£¼ì‹: 6ìë¦¬ ì¢…ëª©ì½”ë“œ + ì ‘ë¯¸ì‚¬
   if market in ("KOSPI", "KS"): return "KS"
   if market in ("KOSDAQ", "KQ"): return "KQ"
   
   # ë¯¸êµ­ ì£¼ì‹: ì ‘ë¯¸ì‚¬ ì—†ìŒ
   if market == "US": return ""
   ```

3. **yfinanceë¥¼ í†µí•œ ë°°ë‹¹ ë°ì´í„° ìˆ˜ì§‘**
yfinanceëŠ” í•œêµ­/ë¯¸êµ­ ì£¼ì‹ ëª¨ë‘ ì§€ì›í•˜ë¯€ë¡œ í†µì¼ëœ ë°©ì‹ìœ¼ë¡œ ë°°ë‹¹ ë°ì´í„° ìˆ˜ì§‘ ê°€ëŠ¥
   ```python
   tk = yf.Ticker(yf_ticker)
   divs = tk.dividends
   
   # ê¸°ê°„ í•„í„°ë§
   mask = (divs.index.date >= start) & (divs.index.date <= end)
   sel = divs.loc[mask]
   ```   

4. **ë°ì´í„° ì •ë¦¬ ë° ì €ì¥**
   - ë°°ë‹¹ê¸ˆ ì •ìˆ˜/ì‹¤ìˆ˜ ì²˜ë¦¬: ì •ìˆ˜ì¸ ê²½ìš° ì†Œìˆ˜ì  ì œê±°í•˜ì—¬ ê°€ë…ì„± í–¥ìƒ
   - ë‚ ì§œ í˜•ì‹ ë³€í™˜ (YYYY.M.D): í•œêµ­ì‹ ë‚ ì§œ í‘œê¸°ë²•ìœ¼ë¡œ í†µì¼
   - CSV ì €ì¥: UTF-8-SIG ì¸ì½”ë”©ìœ¼ë¡œ Excelì—ì„œ í•œê¸€ ì •ìƒ í‘œì‹œ
   

### ì‚¬ìš©ë²•

```bash
# í•œêµ­ ì£¼ì‹ ë°°ë‹¹ ìˆ˜ì§‘
python3 dividend_export.py --ticker 005930 --market KOSPI --start 20200101 --end 20241231 --out samsung_dividends.csv

# ë¯¸êµ­ ì£¼ì‹ ë°°ë‹¹ ìˆ˜ì§‘
python3 dividend_export.py --ticker AAPL --market US --start 20200101 --end 20241231 --out apple_dividends.csv

# ETF ë°°ë‹¹ ìˆ˜ì§‘
python3 dividend_export.py --ticker TSLY --market US --start 20240101 --end 20250801 --out tsly_dividends.csv
```

### ì¶œë ¥ ë°ì´í„° í˜•ì‹

| ì»¬ëŸ¼ëª… | ì„¤ëª… | ì˜ˆì‹œ |
|--------|------|------|
| ISCD | ì¢…ëª©ì½”ë“œ | 005930 |
| ê¸°ì¤€ì¼ | ë°°ë‹¹ ê¸°ì¤€ì¼ | 2024.3.15 |
| ë°°ë‹¹ê¸ˆ | ë°°ë‹¹ ê¸ˆì•¡ | 500 |

## ğŸ”„ ì¼ê´„ ë°°ë‹¹ ìˆ˜ì§‘ (batch_dividends.py)

### ì£¼ìš” ê¸°ëŠ¥
- ì¢…ëª© ëª©ë¡ CSV íŒŒì¼ ê¸°ë°˜ ì¼ê´„ ë°°ë‹¹ ìˆ˜ì§‘
- í–‰ ë²”ìœ„ ì§€ì •ìœ¼ë¡œ ë¶€ë¶„ ì²˜ë¦¬ ì§€ì›
- íŠ¹ì • ì¢…ëª©ë§Œ ì„ ë³„ ì²˜ë¦¬ ê°€ëŠ¥
- ì§„í–‰ ìƒí™© ì‹¤ì‹œê°„ í‘œì‹œ
- ê¸°ì¡´ íŒŒì¼ì— ì´ì–´ì“°ê¸° ì§€ì›

### ì£¼ìš” ë¡œì§ ìˆœì„œ

1. **ëª…ë ¹í–‰ ì¸ì íŒŒì‹±**
ëŒ€ëŸ‰ ì¢…ëª© ì²˜ë¦¬ ì‹œ ìœ ì—°í•œ ì œì–´ê°€ í•„ìš”í•˜ë¯€ë¡œ ë‹¤ì–‘í•œ í•„í„°ë§ ì˜µì…˜ ì œê³µ
   - `--in`: ì…ë ¥ CSV íŒŒì¼ (krx_export.py - ì¢…ëª© ì •ë³´ íŒŒì¼)
   - `--out`: ì¶œë ¥ CSV íŒŒì¼
   - `--start`: ì‹œì‘ì¼ (YYYYMMDD)
   - `--end`: ì¢…ë£Œì¼ (YYYYMMDD)
   - `--only`: íŠ¹ì • ì¢…ëª©ì½”ë“œë§Œ ì²˜ë¦¬
   - `--row-start`: ì²˜ë¦¬ ì‹œì‘ í–‰
   - `--row-end`: ì²˜ë¦¬ ì¢…ë£Œ í–‰

2. **ì…ë ¥ ë°ì´í„° ë¡œë“œ ë° í•„í„°ë§**
   ```python
   # CSV ë¡œë“œ: ì¢…ëª©ì½”ë“œë¥¼ ë¬¸ìì—´ë¡œ ì½ì–´ 0ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ì½”ë“œ ë³´ì¡´
   src = pd.read_csv(args.infile, dtype={"ISCD": str, "KR_ISNM": str, "MARKET": str})
   ```

3. **ì¢…ëª©ë³„ ë°°ë‹¹ ìˆ˜ì§‘**
   ```python
   #ì¢…ëª©ì½”ë“œë¥¼ 6ìë¦¬ë¡œ ë§ì¶° Yahoo Finance í˜•ì‹ì— ë§ì¶¤
   for idx, row in src.iterrows():
       iscd = str(row.get("ISCD", "")).zfill(6)
       market = row.get("MARKET", "")
       
       # ì‹œì¥ ì½”ë“œ ë³€í™˜ (KOSPI -> KS, KOSDAQ -> KQ)
       mapped = market_to_de_market(market)
       
       # ë°°ë‹¹ ì •ë³´ ìˆ˜ì§‘
       df = de.fetch_dividends_yf(iscd, mapped, start_d, end_d)
   ```

4. **ê²°ê³¼ í†µí•© ë° ì €ì¥**
   - ëª¨ë“  ì¢…ëª©ì˜ ë°°ë‹¹ ë°ì´í„° í†µí•©
   - ì¢…ëª©ì½”ë“œ, ê¸°ì¤€ì¼ ìˆœìœ¼ë¡œ ì •ë ¬
   - ê¸°ì¡´ íŒŒì¼ì— ì´ì–´ì“°ê¸° ë˜ëŠ” ìƒˆ íŒŒì¼ ìƒì„±

### ì‚¬ìš©ë²•

```bash
# ì „ì²´ ì¢…ëª© ë°°ë‹¹ ìˆ˜ì§‘
python3 batch_dividends.py --in kr_stocks_etfs.csv --out kr_dividends.csv --start 20200101 --end 20241231

# í–‰ ë²”ìœ„ ì§€ì • (--row-start, --row-end ì˜µì…˜)
python3 batch_dividends.py --in kr_stocks_etfs.csv --row-start 2001 --row-end 3782 --start 20200101 --end 20241231 --out kr_divs.csv

# íŠ¹ì • ì¢…ëª©ë§Œ ìˆ˜ì§‘ (--only ì˜µì…˜)
python3 batch_dividends.py --in kr_stocks_etfs.csv --only 005930,000660 --out selected_dividends.csv
```

### ëŒ€ìš©ëŸ‰ ë°ì´í„° ë¶„í•  ì²˜ë¦¬ ì˜ˆì‹œ

```bash
# 1ë‹¨ê³„: 1~1000í–‰ ì²˜ë¦¬ (2020~2024ë…„ ë°°ë‹¹)
python3 batch_dividends.py --in kr_stocks_etfs.csv --row-start 1 --row-end 1000 --start 20200101 --end 20241231 --out kr_dividends.csv

# 2ë‹¨ê³„: 1001~2000í–‰ ì²˜ë¦¬ (ê°™ì€ íŒŒì¼ì— ì¶”ê°€ë¨)
python3 batch_dividends.py --in kr_stocks_etfs.csv --row-start 1001 --row-end 2000 --start 20200101 --end 20241231 --out kr_dividends.csv

# 3ë‹¨ê³„: 2001~3000í–‰ ì²˜ë¦¬ (ê°™ì€ íŒŒì¼ì— ì¶”ê°€ë¨)
python3 batch_dividends.py --in kr_stocks_etfs.csv --row-start 2001 --row-end 3000 --start 20200101 --end 20241231 --out kr_dividends.csv
```

**ê²°ê³¼**: `kr_dividends.csv` íŒŒì¼ì— 3000ê°œ ì¢…ëª©ì˜ 2020~2024ë…„ ë°°ë‹¹ ì •ë³´ê°€ ëª¨ë‘ ëˆ„ì ë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤.

### ì¶œë ¥ ë°ì´í„° í˜•ì‹

| ì»¬ëŸ¼ëª… | ì„¤ëª… | ì˜ˆì‹œ |
|--------|------|------|
| ISCD | ì¢…ëª©ì½”ë“œ | 005930 |
| ê¸°ì¤€ì¼ | ë°°ë‹¹ ê¸°ì¤€ì¼ | 2024.3.15 |
| ë°°ë‹¹ê¸ˆ | ë°°ë‹¹ ê¸ˆì•¡ | 500 |
| KR_ISNM | ì¢…ëª©ëª… | ì‚¼ì„±ì „ì |
| MARKET | ì‹œì¥êµ¬ë¶„ | KOSPI |
